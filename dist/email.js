(()=>{"use strict";function e(e){throw new Error(null!=e?e:"Attempted to get Global AmazonConnectProvider that has not been set.")}class t extends Error{constructor({reason:e,namespace:n,errorKey:s,details:o}){super(`ConnectError with error key "${s}"`),this.errorType=t.ErrorType,this.namespace=n,this.errorKey=s,this.reason=e,this.details=null!=o?o:{}}}t.ErrorType="ConnectError";class n{constructor({provider:e,loggerKey:t}){this.events=new Map,this.logger=new v({provider:e,source:"emitter",mixin:()=>({emitterLoggerKey:t})})}on(e,t){const n=this.events.get(e);n?n.add(t):this.events.set(e,new Set([t]))}off(e,t){const n=this.events.get(e);n&&(n.delete(t),n.size<1&&this.events.delete(e))}getHandlers(e){var t;return Array.from(null!==(t=this.events.get(e))&&void 0!==t?t:[])}}var s,o,r,i,a,c,l,h=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((s=s.apply(e,t||[])).next())}))};class u extends n{emit(e,t){return h(this,void 0,void 0,(function*(){const n=this.getHandlers(e);yield Promise.allSettled(n.map((n=>h(this,void 0,void 0,(function*(){try{yield n(t)}catch(t){this.logger.error("An error occurred when invoking event handler",{error:t,parameter:e})}})))))}))}}class d{constructor({sendMetric:e,metricName:t,metricOptions:n}){this.unit="Milliseconds",this.sendMetric=e,this.startTime=performance.now(),this.metricName=t,this.dimensions=(null==n?void 0:n.dimensions)?n.dimensions:{},this.optionalDimensions=(null==n?void 0:n.optionalDimensions)?n.optionalDimensions:{}}stopDurationCounter(){const e=Math.round(performance.now()-this.startTime);return this.sendMetric({metricName:this.metricName,unit:this.unit,value:e,dimensions:this.dimensions,optionalDimensions:this.optionalDimensions}),{duration:e}}}class g{constructor(e){this._proxy=null,this.namespace=e.namespace,e.provider&&"function"==typeof e.provider?this.providerFactory=e.provider:this.provider=e.provider}recordSuccess(e,t){var n;const s=Object.assign({},null!==(n=null==t?void 0:t.dimensions)&&void 0!==n?n:{}),o=Object.assign(Object.assign({},t),{dimensions:s});this.recordCount(e,0,o)}recordError(e,t){var n;const s=Object.assign({},null!==(n=null==t?void 0:t.dimensions)&&void 0!==n?n:{}),o=Object.assign(Object.assign({},t),{dimensions:s});this.recordCount(e,1,o)}recordCount(e,t,n){this.sendMetric({metricName:e,unit:"Count",value:t,dimensions:null==n?void 0:n.dimensions,optionalDimensions:null==n?void 0:n.optionalDimensions})}startDurationCounter(e,t){return new d({sendMetric:this.sendMetric.bind(this),metricName:e,metricOptions:t})}sendMetric({metricName:e,unit:t,value:n,dimensions:s,optionalDimensions:o}){s&&function(e,t){if(Object.keys(e).length+Object.keys(null!=t?t:{}).length>30)throw new Error("Cannot add more than 30 dimensions to a metric")}(s,o);const r={metricName:e,unit:t,value:n,dimensions:s,optionalDimensions:o},i=new Date;this.getProxy().sendMetric({metricData:r,time:i,namespace:this.namespace})}getProvider(){return this.provider||(this.provider=this.providerFactory?this.providerFactory():e()),this.provider}getProxy(){return this._proxy||(this._proxy=this.getProvider().getProxy()),this._proxy}}class p{constructor({provider:e,sendHealthCheck:t,getUpstreamMessageOrigin:n}){this.connectionId=null,this.healthCheckInterval=null,this.healthCheckTimeout=null,this.sendHealthCheck=t,this.getUpstreamMessageOrigin=n,this.sendHealthCheckInterval=null,this.lastHealthCheckResponse=null,this._status="unknown",this.logger=new v({source:"core.proxy.health-check",provider:e,mixin:()=>({connectionId:this.connectionId})}),this.events=new u({provider:e,loggerKey:"core.proxy.health-check"})}get status(){return this._status}get isRunning(){return null!==this.sendHealthCheckInterval}get lastCheckCounter(){var e,t;return null!==(t=null===(e=this.lastHealthCheckResponse)||void 0===e?void 0:e.counter)&&void 0!==t?t:null}get lastCheckTime(){var e,t;return null!==(t=null===(e=this.lastHealthCheckResponse)||void 0===e?void 0:e.time)&&void 0!==t?t:null}start({healthCheckInterval:e,connectionId:t}){this.connectionId=t,this.healthCheckInterval=e,this.clearInterval(),e<=0?this.logger.debug("Health check disabled"):e<1e3?this.logger.error("Health check interval is less than 1 second. Not running",{interval:e}):(this.sendHealthCheckMessage(),this.sendHealthCheckInterval=setInterval((()=>this.sendHealthCheckMessage()),e),this.startTimeout())}stop(){this.clearInterval(),this.clearTimeout()}handleResponse(e){this.setHealthy({time:e.time,counter:e.counter})}sendHealthCheckMessage(){this.sendHealthCheck({type:"healthCheck",messageOrigin:this.getUpstreamMessageOrigin()})}startTimeout(){this.healthCheckInterval?(this.clearTimeout(),this.healthCheckTimeout=setTimeout((()=>{this.setUnhealthy()}),3*this.healthCheckInterval)):this.logger.error("Health check interval not set. Cannot start timeout")}clearInterval(){this.sendHealthCheckInterval&&(clearInterval(this.sendHealthCheckInterval),this.sendHealthCheckInterval=null)}clearTimeout(){this.healthCheckTimeout&&(clearTimeout(this.healthCheckTimeout),this.healthCheckTimeout=null)}setUnhealthy(){if("unhealthy"!==this._status){const e=this._status;this.logger.info("Connection unhealthy",{previousStatus:e}),this._status="unhealthy",this.emitStatusChanged("unhealthy",e)}}setHealthy(e){if(this.lastHealthCheckResponse=Object.assign({},e),"healthy"!==this._status){const e=this._status;this.logger.debug("Connection healthy",{previousStatus:e}),this._status="healthy",this.emitStatusChanged("healthy",e)}this.startTimeout()}emitStatusChanged(e,t){var n,s,o,r;this.events.emit(p.statusChangedKey,{status:e,previousStatus:t,lastCheckTime:null!==(s=null===(n=this.lastHealthCheckResponse)||void 0===n?void 0:n.time)&&void 0!==s?s:null,lastCheckCounter:null!==(r=null===(o=this.lastHealthCheckResponse)||void 0===o?void 0:o.counter)&&void 0!==r?r:null})}onStatusChanged(e){this.events.on(p.statusChangedKey,e)}offStatusChanged(e){this.events.off(p.statusChangedKey,e)}}p.statusChangedKey="statusChanged",function(e){e[e.trace=1]="trace",e[e.debug=2]="debug",e[e.info=3]="info",e[e.warn=4]="warn",e[e.error=5]="error"}(s||(s={}));class m{constructor(e){this.mixin=e}getTransformedData(e,t){return this.mixin?Object.assign(Object.assign({},null!=t?t:{}),this.mixin(null!=t?t:{},e)):t}}class v{constructor(e){this._proxy=null,this._logToConsoleLevel=null,this.loggerId=function(){const e=new Uint8Array(Math.ceil(4));return crypto.getRandomValues(e),Array.from(e,(e=>e.toString(16).padStart(2,"0"))).join("").substring(0,8)}(),"string"==typeof e?(this.source=e,this.dataTransformer=new m(void 0)):(this.source=e.source,e.provider&&"function"==typeof e.provider?this.providerFactory=e.provider:this.provider=e.provider,this.dataTransformer=new m(e.mixin),this.logOptions=e.options)}trace(e,t,n){this.log(s.trace,e,t,n)}debug(e,t,n){this.log(s.debug,e,t,n)}info(e,t,n){this.log(s.info,e,t,n)}warn(e,t,n){this.log(s.warn,e,t,n)}error(e,t,n){this.log(s.error,e,t,n)}log(e,t,n,o){const r=this.dataTransformer.getTransformedData(e,n);this.ignoreRemote(o)||this.getProxy().log({level:e,source:this.source,loggerId:this.loggerId,message:t,data:r}),this.applyDuplicateMessageToConsole(e,o)&&function(e,t,n){if(n)switch(e){case s.error:console.error(t,n);break;case s.warn:console.warn(t,n);break;case s.info:console.info(t,n);break;case s.debug:console.debug(t,n);break;case s.trace:console.trace(t,n);break;default:console.log(t,n)}else switch(e){case s.error:console.error(t);break;case s.warn:console.warn(t);break;case s.info:console.info(t);break;case s.debug:console.debug(t);break;case s.trace:console.trace(t);break;default:console.log(t)}}(e,t,r)}getProvider(){return this.provider||(this.provider=this.providerFactory?this.providerFactory():e()),this.provider}getProxy(){return this._proxy||(this._proxy=this.getProvider().getProxy()),this._proxy}applyDuplicateMessageToConsole(e,t){return(null==t?void 0:t.duplicateMessageToConsole)||this.getLogConsoleLevel()<=e}getLogConsoleLevel(){var e,t,n,o;return this._logToConsoleLevel||(this._logToConsoleLevel=(null===(e=this.logOptions)||void 0===e?void 0:e.minLogToConsoleLevelOverride)?this.logOptions.minLogToConsoleLevelOverride:null!==(o=null===(n=null===(t=this.getProvider().config)||void 0===t?void 0:t.logging)||void 0===n?void 0:n.minLogToConsoleLevel)&&void 0!==o?o:s.error),this._logToConsoleLevel}ignoreRemote(e){var t,n,s;return null!==(n=null===(t=this.logOptions)||void 0===t?void 0:t.remoteIgnore)&&void 0!==n&&n||null!==(s=null==e?void 0:e.remoteIgnore)&&void 0!==s&&s}}class C{constructor(e,t){this.engineContext=e,this.moduleNamespace=t}get proxy(){if(!this.moduleProxy){const e=this.engineContext.getProxy(),t=this.moduleNamespace;this.moduleProxy=function(e,t){return{request:(n,s)=>e.request(t,n,s),subscribe:(n,s)=>e.subscribe(Object.assign(Object.assign({},n),{namespace:t}),s),unsubscribe:(n,s)=>e.unsubscribe(Object.assign(Object.assign({},n),{namespace:t}),s),getProxyInfo:()=>({connectionStatus:e.connectionStatus,proxyType:e.proxyType}),onConnectionStatusChange:t=>e.onConnectionStatusChange(t),offConnectionStatusChange:t=>e.offConnectionStatusChange(t)}}(e,t)}return this.moduleProxy}createLogger(e){return this.engineContext.createLogger(e)}createMetricRecorder(e){return this.engineContext.createMetricRecorder(e)}}class y{constructor(e){this.provider=e}getProxy(){return this.getProvider().getProxy()}getModuleContext(e){return new C(this,e)}getProvider(){return this.provider?this.provider:e()}createLogger(e){return new v("object"==typeof e?Object.assign(Object.assign({},e),{provider:()=>this.getProvider()}):{source:e,provider:()=>this.getProvider()})}createMetricRecorder(e){return new g("object"==typeof e?Object.assign(Object.assign({},e),{provider:()=>this.getProvider()}):{namespace:e,provider:()=>this.getProvider()})}}class x{constructor(e,t){var n;this.namespace=e,this.context=null!==(n=null==t?void 0:t.context)&&void 0!==n?n:new y(null==t?void 0:t.provider).getModuleContext(e)}}!function(e){e.getEmailData="get-email-data",e.createDraftEmail="create-draft-email",e.sendEmail="send-email",e.getEmailThread="get-email-thread"}(o||(o={})),function(e){e.InboundContactConnected="inbound-contact-connected",e.OutboundContactConnected="outbound-contact-connected"}(r||(r={})),function(e){e.batchGetAttachedFileMetadata="batch-get-attached-file-metadata",e.startAttachedFileUpload="start-attached-file-upload",e.completeAttachedFileUpload="complete-attached-file-upload",e.getAttachedFileUrl="get-attached-file-url",e.deleteAttachedFile="delete-attached-file"}(i||(i={})),function(e){e.APPROVED="APPROVED",e.REJECTED="REJECTED",e.PROCESSING="PROCESSING",e.PENDING_UPLOAD="PENDING_UPLOAD",e.UPLOAD_EXPIRED="UPLOAD_EXPIRED",e.FAILED="FAILED",e.DELETED="DELETED"}(a||(a={})),function(e){e.searchMessageTemplates="search-message-templates",e.getContent="get-content",e.isEnabled="is-enabled"}(c||(c={})),function(e){e.isEnabled="is-enabled",e.searchQuickResponses="search-quick-responses"}(l||(l={})),connect=connect||{},connect.SDK=connect.SDK||{},connect.SDK.EmailClient=class extends x{constructor(e){super("aws.connect.email",e)}getEmailData({contactId:e,activeContactId:t}){return this.context.proxy.request(o.getEmailData,{contactId:e,activeContactId:t})}createDraftEmail(e){return this.context.proxy.request(o.createDraftEmail,e)}getEmailThread(e){return this.context.proxy.request(o.getEmailThread,e)}sendEmail(e){return this.context.proxy.request(o.sendEmail,e)}onAcceptedEmail(e,t){this.context.proxy.subscribe({key:r.InboundContactConnected,parameter:t},e)}offAcceptedEmail(e,t){this.context.proxy.unsubscribe({key:r.InboundContactConnected,parameter:t},e)}onDraftEmailCreated(e,t){this.context.proxy.subscribe({key:r.OutboundContactConnected,parameter:t},e)}offDraftEmailCreated(e,t){this.context.proxy.unsubscribe({key:r.OutboundContactConnected,parameter:t},e)}},connect.SDK.FileClient=class extends x{constructor(e){super("aws.connect.file",e)}batchGetAttachedFileMetadata({relatedAttachments:e,activeContactId:t}){return this.context.proxy.request(i.batchGetAttachedFileMetadata,{relatedAttachments:e,activeContactId:t})}startAttachedFileUpload(e){return this.context.proxy.request(i.startAttachedFileUpload,e)}completeAttachedFileUpload(e){return this.context.proxy.request(i.completeAttachedFileUpload,e)}getAttachedFileUrl({attachment:e,activeContactId:t}){return this.context.proxy.request(i.getAttachedFileUrl,{attachment:e,activeContactId:t})}deleteAttachedFile(e){return this.context.proxy.request(i.deleteAttachedFile,e)}},connect.SDK.TemplateClient=class extends x{constructor(e){super("aws.connect.messageTemplate",e)}isEnabled(){return this.context.proxy.request(c.isEnabled)}searchMessageTemplates(e){return this.context.proxy.request(c.searchMessageTemplates,{request:e})}getContent(e,t){return this.context.proxy.request(c.getContent,{messageTemplateId:e,contactId:t})}},connect.SDK.QuickResponsesClient=class extends x{constructor(e){super("aws.connect.quick-responses",e)}isEnabled(){return this.context.proxy.request(l.isEnabled)}searchQuickResponses(e){return this.context.proxy.request(l.searchQuickResponses,e)}}})();